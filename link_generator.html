<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>CDC2025 - G√©n√©rateur de Lien Overlay</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;800;900&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      font-family: 'Outfit', -apple-system, system-ui;
      background: linear-gradient(135deg, #0b0f14 0%, #1a1f2e 100%);
      color: #f2f5f8;
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 1600px;
      margin: 0 auto;
    }

    h1 {
      text-align: center;
      color: #FCA000;
      margin-bottom: 30px;
      font-size: 2.5em;
      text-shadow: 0 0 20px rgba(252, 160, 0, 0.3);
    }

    .main-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 30px;
      margin-bottom: 30px;
    }

    @media (max-width: 1200px) {
      .main-grid {
        grid-template-columns: 1fr;
      }
    }

    .panel {
      background: rgba(0, 0, 0, 0.4);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 16px;
      padding: 30px;
      backdrop-filter: blur(10px);
    }

    .panel h2 {
      color: #FCA000;
      margin-bottom: 20px;
      font-size: 1.4em;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .category-selector {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 10px;
      margin-bottom: 30px;
    }

    .category-btn {
      padding: 15px;
      background: rgba(100, 150, 200, 0.15);
      border: 2px solid rgba(100, 150, 200, 0.3);
      color: #6496c8;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.2s;
      font-size: 0.9em;
      text-align: center;
    }

    .category-btn:hover {
      background: rgba(100, 150, 200, 0.25);
    }

    .category-btn.active {
      background: rgba(100, 150, 200, 0.4);
      border-color: #6496c8;
      box-shadow: 0 0 15px rgba(100, 150, 200, 0.4);
    }

    .overlay-btn {
      padding: 10px;
      background: rgba(252, 160, 0, 0.1);
      border: 2px solid rgba(252, 160, 0, 0.3);
      color: #FCA000;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 500;
      transition: all 0.2s;
      font-size: 0.85em;
      text-align: center;
    }

    .overlay-btn:hover {
      background: rgba(252, 160, 0, 0.2);
    }

    .overlay-btn.active {
      background: rgba(252, 160, 0, 0.4);
      border-color: #FCA000;
      box-shadow: 0 0 15px rgba(252, 160, 0, 0.3);
    }

    .overlay-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
      gap: 8px;
      margin-bottom: 20px;
    }

    .form-group {
      margin-bottom: 20px;
    }

    label {
      display: block;
      margin-bottom: 8px;
      color: #a7b1bd;
      font-size: 0.95em;
      font-weight: 500;
    }

    .color-input-group {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
    }

    .color-input-wrapper {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .color-input-wrapper label {
      margin-bottom: 0;
    }

    input[type="color"] {
      width: 100%;
      height: 50px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 8px;
      cursor: pointer;
      background: rgba(0, 0, 0, 0.3);
    }

    input[type="range"] {
      width: 100%;
      height: 6px;
      border-radius: 3px;
      background: rgba(255, 255, 255, 0.1);
      outline: none;
      -webkit-appearance: none;
      appearance: none;
      cursor: pointer;
    }

    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: #FCA000;
      cursor: pointer;
      box-shadow: 0 0 10px rgba(252, 160, 0, 0.5);
    }

    input[type="range"]::-moz-range-thumb {
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: #FCA000;
      cursor: pointer;
      border: none;
      box-shadow: 0 0 10px rgba(252, 160, 0, 0.5);
    }

    .intensity-value {
      text-align: center;
      color: #FCA000;
      font-weight: 600;
      font-size: 0.9em;
    }

    .checkbox-group {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .checkbox-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px;
      background: rgba(0, 0, 0, 0.2);
      border-radius: 6px;
      cursor: pointer;
    }

    .checkbox-item input[type="checkbox"] {
      cursor: pointer;
      width: 18px;
      height: 18px;
    }

    .checkbox-item label {
      margin-bottom: 0;
      cursor: pointer;
      flex: 1;
    }

    .preset-buttons {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr 1fr;
      gap: 8px;
      margin-bottom: 20px;
    }

    .preset-btn {
      padding: 8px 12px;
      background: rgba(100, 200, 100, 0.2);
      border: 1px solid rgba(100, 200, 100, 0.3);
      color: #64c864;
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.85em;
      transition: all 0.2s;
    }

    .preset-btn:hover {
      background: rgba(100, 200, 100, 0.3);
      border-color: rgba(100, 200, 100, 0.7);
    }

    .link-section {
      margin-top: 30px;
      padding: 20px;
      background: rgba(252, 160, 0, 0.1);
      border: 1px solid rgba(252, 160, 0, 0.3);
      border-radius: 8px;
    }

    .link-section h3 {
      color: #FCA000;
      margin-bottom: 15px;
      font-size: 1.1em;
    }

    .generated-link {
      background: rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 6px;
      padding: 12px;
      font-family: 'Courier New', monospace;
      font-size: 0.75em;
      word-break: break-all;
      color: #FFE259;
      max-height: 150px;
      overflow-y: auto;
      line-height: 1.4;
      margin-bottom: 12px;
    }

    .button-group {
      display: flex;
      gap: 10px;
    }

    button {
      padding: 12px 20px;
      background: #FCA000;
      color: #000;
      border: none;
      border-radius: 6px;
      font-weight: 600;
      cursor: pointer;
      transition: opacity 0.2s;
      font-size: 1em;
      font-family: 'Outfit', -apple-system, system-ui;
      flex: 1;
    }

    button:hover {
      opacity: 0.9;
    }

    button:active {
      opacity: 0.8;
    }

    .copy-feedback {
      text-align: center;
      color: #64c864;
      font-weight: 600;
      font-size: 0.9em;
      margin-top: 8px;
      display: none;
    }

    .info-box {
      background: rgba(100, 150, 200, 0.1);
      border: 1px solid rgba(100, 150, 200, 0.3);
      border-radius: 6px;
      padding: 12px;
      margin-top: 15px;
      font-size: 0.9em;
      line-height: 1.5;
      color: #a7b1bd;
    }

    .preview-section {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
      margin-top: 20px;
    }

    @media (max-width: 600px) {
      .preview-section {
        grid-template-columns: 1fr;
      }
    }

    .preview-item {
      background: rgba(0, 0, 0, 0.2);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 8px;
      padding: 12px;
      text-align: center;
    }

    .preview-item h4 {
      color: #FCA000;
      margin-bottom: 10px;
      font-size: 0.9em;
    }

    .preview-item p {
      font-size: 0.8em;
      color: #a7b1bd;
      margin-bottom: 10px;
    }

    iframe {
      width: 100%;
      height: 150px;
      border: none;
      border-radius: 6px;
      background: rgba(0, 0, 0, 0.3);
    }
  </style>
</head>
<body>

  <h1>üîó G√©n√©rateur de Lien CDC2025</h1>

  <div class="container">
    <div class="main-grid">
      <!-- Configuration Panel -->
      <div class="panel">
        <h2>‚öôÔ∏è Configuration</h2>

        <!-- Macro Category Selection -->
        <div class="form-group">
          <label style="color: #6496c8; font-size: 1em; font-weight: 700;">Type d'overlay</label>
          <div class="category-selector" id="categorySelector"></div>
        </div>

        <!-- Overlay Selection -->
        <div class="form-group">
          <label style="color: #FCA000; font-weight: 600;">S√©lectionne une overlay</label>
          <div class="overlay-grid" id="overlayGrid"></div>
        </div>

        <!-- Customization Options (Dynamic) -->
        <div id="customOptions" style="display: none;">
          <!-- Theme Selection -->
          <div id="themeOptions" style="display: none; margin-bottom: 20px;">
            <label style="color: #FCA000; font-weight: 600;">Th√®me</label>
            <div class="category-selector" id="themeSelector">
              <button class="category-btn theme-btn" data-theme="light">‚òÄÔ∏è Light</button>
              <button class="category-btn theme-btn" data-theme="dark">üåô Dark</button>
              <button class="category-btn theme-btn" data-theme="auto">‚öôÔ∏è Auto</button>
            </div>
          </div>

          <div class="preset-buttons" id="presetButtons"></div>

          <!-- Color Options -->
          <div id="colorOptions" style="display: none;">
            <label style="color: #FCA000; font-weight: 600;">Couleurs</label>
            <div class="color-input-group">
              <div class="color-input-wrapper">
                <label>Couleur du texte</label>
                <input type="color" id="textColor" value="#ffffff" onchange="updatePreview()">
              </div>
              <div class="color-input-wrapper">
                <label>Couleur accent</label>
                <input type="color" id="accentColor" value="#FCA000" onchange="updatePreview()">
              </div>
            </div>
          </div>

          <!-- Shadow/Opacity Options -->
          <div id="shadowOptions" style="display: none; margin-top: 20px;">
            <label>Intensit√© de l'ombre</label>
            <div style="display: flex; gap: 10px; align-items: center;">
              <input type="range" id="shadowIntensity" min="0" max="1" step="0.1" value="0.4" onchange="updatePreview()">
              <span class="intensity-value" id="shadowValue">0.4</span>
            </div>
          </div>

          <!-- Background Opacity (for Info widgets) -->
          <div id="opacityOptions" style="display: none; margin-top: 20px;">
            <label>Transparence du fond</label>
            <div style="display: flex; gap: 10px; align-items: center;">
              <input type="range" id="bgOpacity" min="0" max="1" step="0.1" value="0.5" onchange="updatePreview()">
              <span class="intensity-value" id="opacityValue">0.5</span>
            </div>
          </div>

          <div class="checkbox-group" id="centsOption" style="display:none; margin-top: 15px;">
            <div class="checkbox-item">
              <input type="checkbox" id="showCents" onchange="updatePreview()">
              <label for="showCents">Afficher les centimes (0.50‚Ç¨)</label>
            </div>
          </div>
        </div>

        <!-- Link Section -->
        <div class="link-section">
          <h3>üìã Lien g√©n√©r√©</h3>
          <div class="generated-link" id="generatedLink">S√©lectionne une overlay...</div>
          <div class="button-group">
            <button onclick="copyLink()">üìã Copier</button>
            <button onclick="openInNewTab()" style="background: rgba(100, 150, 200, 0.5);">üîó Ouvrir</button>
          </div>
          <div class="copy-feedback" id="copyFeedback">‚úì Copi√©!</div>
        </div>
      </div>

      <!-- Preview Panel -->
      <div class="panel">
        <h2>üëÅÔ∏è Aper√ßu</h2>
        <div id="previewContainer"></div>
        <div class="info-box" style="margin-top: 30px;">
          <strong>üé¨ Comment l'utiliser:</strong><br>
          1. S√©lectionne le type<br>
          2. Choisis une overlay<br>
          3. Configure les couleurs<br>
          4. Copie le lien<br>
          5. Colle dans OBS
        </div>
      </div>
    </div>
  </div>

  <script>
    const GITHUB_URL = 'https://createursdecompagnie.github.io/cdc2025-live-stats';
    
    const overlaysByCategory = {
      Cagnotte: {
        'cdc_goal_widget_simple.html': {
          label: 'Simple',
          desc: 'Montant seul',
          supportColors: true,
          supportCents: true,
          showPreview: true
        },
        'cdc_goal_widget.html': {
          label: 'Complet',
          desc: 'Avec CDC2025',
          supportColors: true,
          supportCents: true,
          showPreview: true
        }
      },
      Infos: {
        'info_widget.html': {
          label: 'Info Standard',
          desc: 'Infos √©v√©nement',
          supportColors: true,
          supportCents: false,
          showPreview: true,
          customOptions: {
            themes: true,
            textColor: true,
            accentColor: true,
            bgOpacity: true
          }
        },
        'info_widget_vertical.html': {
          label: 'Info Vertical',
          desc: 'Infos verticales',
          supportColors: false,
          supportCents: false,
          showPreview: true
        },
        'info_carousel_square.html': {
          label: 'Carousel Carr√©',
          desc: 'Carousel infos',
          supportColors: false,
          supportCents: false,
          showPreview: true
        }
      },
      Barres: {
        'donation_bar.html': {
          label: 'Barre Donation',
          desc: 'Progression',
          supportColors: false,
          supportCents: false,
          showPreview: true
        },
        'Widget_Bar.html': {
          label: 'Bar Horizontal',
          desc: 'Barre standard',
          supportColors: false,
          supportCents: false,
          showPreview: true
        },
        'Widget_Bar_Vertical.html': {
          label: 'Bar Vertical',
          desc: 'Barre verticale',
          supportColors: false,
          supportCents: false,
          showPreview: true
        }
      }
    };

    const presets = {
      default: { textColor: '#ffffff', accentColor: '#FCA000', shadowIntensity: 0.4 },
      dark: { textColor: '#e0e0e0', accentColor: '#ff6b00', shadowIntensity: 0.6 },
      neon: { textColor: '#00ffff', accentColor: '#ff00ff', shadowIntensity: 0.8 },
      pastel: { textColor: '#fff9e6', accentColor: '#ff69b4', shadowIntensity: 0.3 }
    };

    let currentCategory = null;
    let currentOverlay = null;

    function initCategorySelector() {
      const selector = document.getElementById('categorySelector');
      Object.keys(overlaysByCategory).forEach(cat => {
        const btn = document.createElement('button');
        btn.className = 'category-btn';
        btn.textContent = cat;
        btn.onclick = () => selectCategory(cat);
        selector.appendChild(btn);
      });
      selectCategory(Object.keys(overlaysByCategory)[0]);

      // Add theme button event listeners
      const themeSelector = document.getElementById('themeSelector');
      if (themeSelector) {
        themeSelector.querySelectorAll('.theme-btn').forEach(btn => {
          btn.addEventListener('click', () => {
            applyTheme(btn.dataset.theme);
          });
        });
      }
    }

    function selectCategory(cat) {
      currentCategory = cat;
      document.querySelectorAll('.category-btn').forEach(btn => {
        btn.classList.toggle('active', btn.textContent === cat);
      });
      populateOverlays();
    }

    function populateOverlays() {
      const grid = document.getElementById('overlayGrid');
      grid.innerHTML = '';
      const overlays = overlaysByCategory[currentCategory];
      Object.entries(overlays).forEach(([file, info]) => {
        const btn = document.createElement('button');
        btn.className = 'overlay-btn';
        btn.textContent = info.label;
        btn.title = info.desc;
        btn.onclick = () => selectOverlay(file, info);
        grid.appendChild(btn);
      });
      selectOverlay(Object.keys(overlays)[0], Object.values(overlays)[0]);
    }

    function selectOverlay(file, info) {
      currentOverlay = { file, ...info };
      document.querySelectorAll('.overlay-btn').forEach(btn => btn.classList.remove('active'));
      event.target.classList.add('active');
      updateCustomOptions();
      updatePreview();
    }

    function updateCustomOptions() {
      const customOpts = document.getElementById('customOptions');
      const presetBtns = document.getElementById('presetButtons');
      const centsOpt = document.getElementById('centsOption');
      const themeOpts = document.getElementById('themeOptions');
      const colorOpts = document.getElementById('colorOptions');
      const shadowOpts = document.getElementById('shadowOptions');
      const opacityOpts = document.getElementById('opacityOptions');

      // Cagnotte: Show colors + shadow + cents option
      if (currentOverlay.file.includes('cdc_goal_widget')) {
        customOpts.style.display = 'block';
        presetBtns.style.display = 'grid';
        presetBtns.innerHTML = '';
        ['default', 'dark', 'neon', 'pastel'].forEach(name => {
          const btn = document.createElement('button');
          btn.className = 'preset-btn';
          btn.textContent = name.charAt(0).toUpperCase() + name.slice(1);
          btn.onclick = () => applyPreset(name);
          presetBtns.appendChild(btn);
        });
        colorOpts.style.display = 'block';
        shadowOpts.style.display = 'block';
        opacityOpts.style.display = 'none';
        themeOpts.style.display = 'none';
        centsOpt.style.display = currentOverlay.supportCents ? 'flex' : 'none';
      }
      // Info widgets: Show themes + colors + opacity
      else if (currentOverlay.file.includes('info_widget')) {
        customOpts.style.display = 'block';
        presetBtns.style.display = 'none';
        themeOpts.style.display = 'block';
        colorOpts.style.display = 'block';
        shadowOpts.style.display = 'none';
        opacityOpts.style.display = 'block';
        centsOpt.style.display = 'none';
        
        // Initialize theme buttons
        const themeSelector = document.getElementById('themeSelector');
        if (themeSelector) {
          themeSelector.querySelectorAll('.theme-btn').forEach(btn => {
            btn.classList.remove('active');
            if (btn.dataset.theme === 'light') btn.classList.add('active');
          });
        }
      }
      // Other overlays: Hide options
      else {
        customOpts.style.display = 'none';
      }
    }

    function applyPreset(name) {
      const p = presets[name];
      document.getElementById('textColor').value = p.textColor;
      document.getElementById('accentColor').value = p.accentColor;
      document.getElementById('shadowIntensity').value = p.shadowIntensity;
      updatePreview();
    }

    function applyTheme(theme) {
      document.querySelectorAll('.theme-btn').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.theme === theme);
      });
      updatePreview();
    }

    function updatePreview() {
      const textColor = document.getElementById('textColor').value;
      const accentColor = document.getElementById('accentColor').value;
      const shadowIntensity = document.getElementById('shadowIntensity').value;
      const bgOpacity = document.getElementById('bgOpacity').value;
      const showCents = document.getElementById('showCents').checked;

      // Get theme if available
      const themeBtn = document.querySelector('.theme-btn.active');
      const theme = themeBtn ? themeBtn.dataset.theme : 'light';

      if (currentOverlay.supportColors) {
        if (currentOverlay.file.includes('cdc_goal_widget')) {
          document.getElementById('shadowValue').textContent = shadowIntensity;
        }
        if (currentOverlay.file.includes('info_widget')) {
          document.getElementById('opacityValue').textContent = bgOpacity;
        }
      }

      const params = new URLSearchParams();
      
      // Cagnotte parameters
      if (currentOverlay.file.includes('cdc_goal_widget')) {
        params.append('textColor', textColor);
        params.append('accentColor', accentColor);
        params.append('shadowIntensity', shadowIntensity);
        if (currentOverlay.supportCents && showCents) {
          params.append('showCents', 'true');
        }
      }
      // Info parameters
      else if (currentOverlay.file.includes('info_widget')) {
        params.append('theme', theme);
        params.append('textColor', textColor);
        params.append('accentColor', accentColor);
        params.append('bgOpacity', bgOpacity);
      }

      const fullUrl = `${GITHUB_URL}/${currentOverlay.file}${params.toString() ? '?' + params.toString() : ''}`;
      document.getElementById('generatedLink').textContent = fullUrl;

      // Render preview
      renderPreview(textColor, accentColor, shadowIntensity, bgOpacity, showCents, theme);
    }

    function renderPreview(textColor, accentColor, shadowIntensity, bgOpacity, showCents, theme) {
      const container = document.getElementById('previewContainer');
      container.innerHTML = '';

      if (currentOverlay.showPreview) {
        const params = new URLSearchParams();
        
        if (currentOverlay.file.includes('cdc_goal_widget')) {
          params.append('textColor', textColor);
          params.append('accentColor', accentColor);
          params.append('shadowIntensity', shadowIntensity);
          if (currentOverlay.supportCents && showCents) {
            params.append('showCents', 'true');
          }
        } else if (currentOverlay.file.includes('info_widget')) {
          params.append('theme', theme || 'light');
          params.append('textColor', textColor);
          params.append('accentColor', accentColor);
          params.append('bgOpacity', bgOpacity);
        }

        const url = `${GITHUB_URL}/${currentOverlay.file}${params.toString() ? '?' + params.toString() : ''}`;

        const item = document.createElement('div');
        item.className = 'preview-item';
        item.innerHTML = `
          <h4>${currentOverlay.label}</h4>
          <p>${currentOverlay.desc}</p>
          <iframe src="${url}"></iframe>
        `;
        container.appendChild(item);
      } else {
        container.innerHTML = '<div class="info-box">Cet overlay n\'a pas d\'aper√ßu disponible en iframe. V√©rifie le lien g√©n√©r√© directement!</div>';
      }
    }

    function copyLink() {
      const link = document.getElementById('generatedLink').textContent;
      navigator.clipboard.writeText(link).then(() => {
        const feedback = document.getElementById('copyFeedback');
        feedback.style.display = 'block';
        setTimeout(() => {
          feedback.style.display = 'none';
        }, 2000);
      });
    }

    function openInNewTab() {
      const link = document.getElementById('generatedLink').textContent;
      window.open(link, '_blank');
    }

    window.addEventListener('load', initCategorySelector);
  </script>

</body>
</html>
