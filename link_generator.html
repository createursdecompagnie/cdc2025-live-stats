<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>CDC2025 - G√©n√©rateur de Lien Overlay</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;800;900&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      font-family: 'Outfit', -apple-system, system-ui;
      background: linear-gradient(135deg, #0b0f14 0%, #1a1f2e 100%);
      color: #f2f5f8;
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 1600px;
      margin: 0 auto;
    }

    h1 {
      text-align: center;
      color: #FCA000;
      margin-bottom: 30px;
      font-size: 2.5em;
      text-shadow: 0 0 20px rgba(252, 160, 0, 0.3);
    }

    .main-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 30px;
      margin-bottom: 30px;
    }

    @media (max-width: 1200px) {
      .main-grid {
        grid-template-columns: 1fr;
      }
    }

    .panel {
      background: rgba(0, 0, 0, 0.4);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 16px;
      padding: 30px;
      backdrop-filter: blur(10px);
    }

    .panel h2 {
      color: #FCA000;
      margin-bottom: 20px;
      font-size: 1.4em;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .category-selector {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 10px;
      margin-bottom: 30px;
    }

    .category-btn {
      padding: 15px;
      background: rgba(100, 150, 200, 0.15);
      border: 2px solid rgba(100, 150, 200, 0.3);
      color: #6496c8;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.2s;
      font-size: 0.9em;
      text-align: center;
    }

    .category-btn:hover {
      background: rgba(100, 150, 200, 0.25);
    }

    .category-btn.active {
      background: rgba(100, 150, 200, 0.4);
      border-color: #6496c8;
      box-shadow: 0 0 15px rgba(100, 150, 200, 0.4);
    }

    .overlay-btn {
      padding: 10px;
      background: rgba(252, 160, 0, 0.1);
      border: 2px solid rgba(252, 160, 0, 0.3);
      color: #FCA000;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 500;
      transition: all 0.2s;
      font-size: 0.85em;
      text-align: center;
    }

    .overlay-btn:hover {
      background: rgba(252, 160, 0, 0.2);
    }

    .overlay-btn.active {
      background: rgba(252, 160, 0, 0.4);
      border-color: #FCA000;
      box-shadow: 0 0 15px rgba(252, 160, 0, 0.3);
    }

    .overlay-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
      gap: 8px;
      margin-bottom: 20px;
    }

    .form-group {
      margin-bottom: 20px;
    }

    label {
      display: block;
      margin-bottom: 8px;
      color: #a7b1bd;
      font-size: 0.95em;
      font-weight: 500;
    }

    .color-input-group {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
    }

    .color-input-wrapper {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .color-input-wrapper label {
      margin-bottom: 0;
    }

    input[type="color"] {
      width: 100%;
      height: 50px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 8px;
      cursor: pointer;
      background: rgba(0, 0, 0, 0.3);
    }

    input[type="range"] {
      width: 100%;
      height: 6px;
      border-radius: 3px;
      background: rgba(255, 255, 255, 0.1);
      outline: none;
      -webkit-appearance: none;
      appearance: none;
      cursor: pointer;
    }

    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: #FCA000;
      cursor: pointer;
      box-shadow: 0 0 10px rgba(252, 160, 0, 0.5);
    }

    input[type="range"]::-moz-range-thumb {
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: #FCA000;
      cursor: pointer;
      border: none;
      box-shadow: 0 0 10px rgba(252, 160, 0, 0.5);
    }

    .intensity-value {
      text-align: center;
      color: #FCA000;
      font-weight: 600;
      font-size: 0.9em;
    }

    .checkbox-group {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .checkbox-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px;
      background: rgba(0, 0, 0, 0.2);
      border-radius: 6px;
      cursor: pointer;
    }

    .checkbox-item input[type="checkbox"] {
      cursor: pointer;
      width: 18px;
      height: 18px;
    }

    .checkbox-item label {
      margin-bottom: 0;
      cursor: pointer;
      flex: 1;
    }

    .preset-buttons {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr 1fr;
      gap: 8px;
      margin-bottom: 20px;
    }

    .preset-btn {
      padding: 8px 12px;
      background: rgba(100, 200, 100, 0.2);
      border: 1px solid rgba(100, 200, 100, 0.3);
      color: #64c864;
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.85em;
      transition: all 0.2s;
    }

    .preset-btn:hover {
      background: rgba(100, 200, 100, 0.3);
      border-color: rgba(100, 200, 100, 0.7);
    }

    .link-section {
      margin-top: 30px;
      padding: 20px;
      background: rgba(252, 160, 0, 0.1);
      border: 1px solid rgba(252, 160, 0, 0.3);
      border-radius: 8px;
    }

    .link-section h3 {
      color: #FCA000;
      margin-bottom: 15px;
      font-size: 1.1em;
    }

    .generated-link {
      background: rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 6px;
      padding: 12px;
      font-family: 'Courier New', monospace;
      font-size: 0.75em;
      word-break: break-all;
      color: #FFE259;
      max-height: 150px;
      overflow-y: auto;
      line-height: 1.4;
      margin-bottom: 12px;
    }

    .button-group {
      display: flex;
      gap: 10px;
    }

    button {
      padding: 12px 20px;
      background: #FCA000;
      color: #000;
      border: none;
      border-radius: 6px;
      font-weight: 600;
      cursor: pointer;
      transition: opacity 0.2s;
      font-size: 1em;
      font-family: 'Outfit', -apple-system, system-ui;
      flex: 1;
    }

    button:hover {
      opacity: 0.9;
    }

    button:active {
      opacity: 0.8;
    }

    .copy-feedback {
      text-align: center;
      color: #64c864;
      font-weight: 600;
      font-size: 0.9em;
      margin-top: 8px;
      display: none;
    }

    .info-box {
      background: rgba(100, 150, 200, 0.1);
      border: 1px solid rgba(100, 150, 200, 0.3);
      border-radius: 6px;
      padding: 12px;
      margin-top: 15px;
      font-size: 0.9em;
      line-height: 1.5;
      color: #a7b1bd;
    }

    .preview-section {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
      margin-top: 20px;
    }

    @media (max-width: 600px) {
      .preview-section {
        grid-template-columns: 1fr;
      }
    }

    .preview-item {
      background: rgba(0, 0, 0, 0.2);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 8px;
      padding: 12px;
      text-align: center;
    }

    .preview-item h4 {
      color: #FCA000;
      margin-bottom: 10px;
      font-size: 0.9em;
    }

    .preview-item p {
      font-size: 0.8em;
      color: #a7b1bd;
      margin-bottom: 10px;
    }

    iframe {
      width: 100%;
      height: 150px;
      border: none;
      border-radius: 6px;
      background: rgba(0, 0, 0, 0.3);
    }

    /* Taller iframes for info widgets */
    .preview-item iframe[data-type="info"] {
      height: 375px; /* 150px * 2.5 */
    }
  </style>
</head>
<body>

  <h1>üîó G√©n√©rateur de Lien CDC2025</h1>

  <div class="container">
    <div class="main-grid">
      <!-- Configuration Panel -->
      <div class="panel">
        <h2>‚öôÔ∏è Configuration</h2>

        <!-- Macro Category Selection -->
        <div class="form-group">
          <label style="color: #6496c8; font-size: 1em; font-weight: 700;">Type d'overlay</label>
          <div class="category-selector" id="categorySelector"></div>
        </div>

        <!-- Overlay Selection -->
        <div class="form-group">
          <label style="color: #FCA000; font-weight: 600;">S√©lectionne une overlay</label>
          <div class="overlay-grid" id="overlayGrid"></div>
        </div>

        <!-- Customization Options (Dynamic) -->
        <div id="customOptions" style="display: none;">
          <!-- Theme Selection -->
          <div id="themeOptions" style="display: none; margin-bottom: 20px;">
            <label style="color: #FCA000; font-weight: 600;">Th√®me</label>
            <div class="category-selector" id="themeSelector">
              <button class="category-btn theme-btn" data-theme="light" onclick="applyTheme('light')">‚òÄÔ∏è Light</button>
              <button class="category-btn theme-btn" data-theme="dark" onclick="applyTheme('dark')">üåô Dark</button>
              <button class="category-btn theme-btn" data-theme="auto" onclick="applyTheme('auto')">‚öôÔ∏è Auto</button>
            </div>
          </div>

          <div class="preset-buttons" id="presetButtons"></div>

          <!-- Color Options -->
          <div id="colorOptions" style="display: none;">
            <label style="color: #FCA000; font-weight: 600;">Couleurs</label>
            <div class="color-input-group">
              <div class="color-input-wrapper">
                <label>Couleur du texte</label>
                <input type="color" id="textColor" value="#ffffff" onchange="updatePreview()">
              </div>
              <div class="color-input-wrapper">
                <label>Couleur accent</label>
                <input type="color" id="accentColor" value="#FCA000" onchange="updatePreview()">
              </div>
            </div>
          </div>

          <!-- Shadow/Opacity Options -->
          <div id="shadowOptions" style="display: none; margin-top: 20px;">
            <label>Intensit√© de l'ombre</label>
            <div style="display: flex; gap: 10px; align-items: center;">
              <input type="range" id="shadowIntensity" min="0" max="1" step="0.1" value="0.4" onchange="updatePreview()">
              <span class="intensity-value" id="shadowValue">0.4</span>
            </div>
          </div>

          <!-- Background Opacity (for Info widgets) -->
          <div id="opacityOptions" style="display: none; margin-top: 20px;">
            <label>Transparence du fond</label>
            <div style="display: flex; gap: 10px; align-items: center;">
              <input type="range" id="bgOpacity" min="0" max="1" step="0.1" value="0.5" onchange="updatePreview()">
              <span class="intensity-value" id="opacityValue">0.5</span>
            </div>
          </div>

          <!-- Visibility Options (for Info widgets) -->
          <div id="visibilityOptions" style="display: none; margin-top: 20px;">
            <label style="color: #FCA000; font-weight: 600;">Sections visibles</label>
            <div class="checkbox-group">
              <div class="checkbox-item">
                <input type="checkbox" id="showPersonal" checked onchange="updatePreview()">
                <label for="showPersonal">Objectif personnel</label>
              </div>
              <div class="checkbox-item">
                <input type="checkbox" id="showBranding" checked onchange="updatePreview()">
                <label for="showBranding">Branding</label>
              </div>
              <div class="checkbox-item">
                <input type="checkbox" id="showStats" checked onchange="updatePreview()">
                <label for="showStats">Statistiques</label>
              </div>
              <div class="checkbox-item">
                <input type="checkbox" id="showInfo" checked onchange="updatePreview()">
                <label for="showInfo">Carousel Infos</label>
              </div>
            </div>
          </div>

          <div class="checkbox-group" id="centsOption" style="display:none; margin-top: 15px;">
            <div class="checkbox-item">
              <input type="checkbox" id="showCents" onchange="updatePreview()">
              <label for="showCents">Afficher les centimes (0.50‚Ç¨)</label>
            </div>
          </div>

          <!-- Widget Creators Options -->
          <div id="creatorsOptions" style="display: none; margin-top: 20px;">
            <label style="color: #FCA000; font-weight: 600;">Personnalisation Cr√©ateurs</label>
            
            <!-- Creators Themes -->
            <div style="margin-top: 15px; display: grid; grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap: 10px;">
              <button class="preset-btn" onclick="applyCreatorsTheme('default')" style="background: rgba(252,160,0,0.2); border: 2px solid rgba(252,160,0,0.5);">üü° Default</button>
              <button class="preset-btn" onclick="applyCreatorsTheme('dark')" style="background: rgba(255,107,0,0.2); border: 2px solid rgba(255,107,0,0.5);">üåô Dark</button>
              <button class="preset-btn" onclick="applyCreatorsTheme('neon')" style="background: rgba(255,0,255,0.2); border: 2px solid rgba(255,0,255,0.5);">‚ö° Neon</button>
              <button class="preset-btn" onclick="applyCreatorsTheme('pastel')" style="background: rgba(255,105,180,0.2); border: 2px solid rgba(255,105,180,0.5);">üå∏ Pastel</button>
            </div>
            
            <div style="margin-top: 15px;">
              <label>Couleur des contours EN DIRECT</label>
              <input type="color" id="borderLive" value="#ff6961" onchange="updatePreview()">
            </div>
            
            <div style="margin-top: 15px;">
              <label>Couleur des contours HORS LIVE</label>
              <input type="color" id="borderOffline" value="#b0b0b0" onchange="updatePreview()">
            </div>
            
            <div style="margin-top: 15px;">
              <label>Couleur du texte</label>
              <input type="color" id="creatorsTextColor" value="#f2f5f8" onchange="updatePreview()">
            </div>
            
            <div style="margin-top: 15px;">
              <label>Couleur accent (fondateur, pinned)</label>
              <input type="color" id="creatorsAccentColor" value="#FCA000" onchange="updatePreview()">
            </div>
            
            <div style="margin-top: 15px;">
              <label>Label EN DIRECT (ex: "EN DIRECT")</label>
              <input type="text" id="labelLive" placeholder="EN DIRECT" style="width: 100%; padding: 8px; border-radius: 4px; border: 1px solid rgba(255,255,255,0.2); background: rgba(0,0,0,0.3); color: #f2f5f8;" onchange="updatePreview()">
            </div>
            
            <div style="margin-top: 15px;">
              <label>Label HORS LIVE (ex: "HORS LIVE")</label>
              <input type="text" id="labelOffline" placeholder="HORS LIVE" style="width: 100%; padding: 8px; border-radius: 4px; border: 1px solid rgba(255,255,255,0.2); background: rgba(0,0,0,0.3); color: #f2f5f8;" onchange="updatePreview()">
            </div>

            <div style="margin-top: 15px;">
              <label>Couleur du fond</label>
              <input type="color" id="bgColor" value="#0b0f14" onchange="updatePreview()">
            </div>

            <div style="margin-top: 15px;">
              <label>Opacit√© du fond</label>
              <div style="display: flex; gap: 10px; align-items: center;">
                <input type="range" id="bgOpacityCreators" min="0" max="1" step="0.1" value="0.85" onchange="updatePreview()">
                <span class="intensity-value" id="bgOpacityCreatorsValue">0.85</span>
              </div>
            </div>

            <div style="margin-top: 15px;">
              <label>Couleur du fond des tags</label>
              <input type="color" id="tagBgColor" value="#0b0f14" onchange="updatePreview()">
            </div>

            <div style="margin-top: 15px;">
              <label>Opacit√© du fond des tags</label>
              <div style="display: flex; gap: 10px; align-items: center;">
                <input type="range" id="tagBgOpacity" min="0" max="1" step="0.1" value="1" onchange="updatePreview()">
                <span class="intensity-value" id="tagBgOpacityValue">1</span>
              </div>
            </div>
          </div>

          <!-- Widget Bar Options -->
          <div id="barOptions" style="display: none; margin-top: 20px;">
            <label style="color: #FCA000; font-weight: 600;">Personnalisation Barre</label>
            
            <!-- Bar Themes -->
            <div style="margin-top: 15px; display: grid; grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap: 10px;">
              <button class="preset-btn" onclick="applyBarTheme('default')" style="background: rgba(252,160,0,0.2); border: 2px solid rgba(252,160,0,0.5);">üü° Default</button>
              <button class="preset-btn" onclick="applyBarTheme('dark')" style="background: rgba(255,107,0,0.2); border: 2px solid rgba(255,107,0,0.5);">üåô Dark</button>
              <button class="preset-btn" onclick="applyBarTheme('neon')" style="background: rgba(255,0,255,0.2); border: 2px solid rgba(255,0,255,0.5);">‚ö° Neon</button>
              <button class="preset-btn" onclick="applyBarTheme('pastel')" style="background: rgba(255,105,180,0.2); border: 2px solid rgba(255,105,180,0.5);">üå∏ Pastel</button>
            </div>
            
            <div style="margin-top: 15px;">
              <label>Couleur du texte</label>
              <input type="color" id="barTextColor" value="#f2f5f8" onchange="updatePreview()">
            </div>
            
            <div style="margin-top: 15px;">
              <label>Couleur des chiffres</label>
              <input type="color" id="barNumbersColor" value="#ffffff" onchange="updatePreview()">
            </div>
            
            <div style="margin-top: 15px;">
              <label>Couleur d'accent (cagnotte)</label>
              <input type="color" id="barAccentColor" value="#FCA000" onchange="updatePreview()">
            </div>
            
            <div style="margin-top: 15px;">
              <label>Couleur de fond</label>
              <input type="color" id="barBgColor" value="#0b0f14" onchange="updatePreview()">
            </div>
            
            <div style="margin-top: 15px;">
              <label>Opacit√© de la barre</label>
              <div style="display: flex; gap: 10px; align-items: center;">
                <input type="range" id="barOpacitySlider" min="0" max="1" step="0.1" value="0.75" onchange="updatePreview()">
                <span class="intensity-value" id="barOpacityValue">0.75</span>
              </div>
            </div>

            <div style="margin-top: 15px;">
              <label>D√©grad√© logo - D√©but</label>
              <input type="color" id="logoGradStart" value="#FFE259" onchange="updatePreview()">
            </div>

            <div style="margin-top: 15px;">
              <label>D√©grad√© logo - Fin</label>
              <input type="color" id="logoGradEnd" value="#FFA751" onchange="updatePreview()">
            </div>

            <div style="margin-top: 15px;">
              <label>Couleur du contour cagnotte</label>
              <input type="color" id="barCagnotteColor" value="#FCA000" onchange="updatePreview()">
            </div>

            <div style="margin-top: 15px;">
              <label>Texte du hashtag</label>
              <input type="text" id="barHashtag" placeholder="#ProtectionAnimale" style="width: 100%; padding: 8px; border-radius: 4px; border: 1px solid rgba(255,255,255,0.2); background: rgba(0,0,0,0.3); color: #f2f5f8;" onchange="updatePreview()">
            </div>

            <div style="margin-top: 20px;">
              <label style="color: #FCA000; font-weight: 600;">√âl√©ments visibles</label>
              <div class="checkbox-group">
                <div class="checkbox-item">
                  <input type="checkbox" id="barShowCagnotte" checked onchange="updatePreview()">
                  <label for="barShowCagnotte">Cagnotte</label>
                </div>
                <div class="checkbox-item">
                  <input type="checkbox" id="barShowStats" checked onchange="updatePreview()">
                  <label for="barShowStats">Stats (viewers/live)</label>
                </div>
                <div class="checkbox-item">
                  <input type="checkbox" id="barShowHashtag" checked onchange="updatePreview()">
                  <label for="barShowHashtag">Hashtag</label>
                </div>
              </div>
            </div>
          </div>

          <!-- Donation Bar Options -->
          <div id="donationOptions" style="display: none; margin-top: 20px;">
            <label style="color: #FCA000; font-weight: 600;">Personnalisation Barre Donation</label>
            
            <!-- Donation Themes -->
            <div style="margin-top: 15px; display: grid; grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap: 10px;">
              <button class="preset-btn" onclick="applyDonationTheme('default')" style="background: rgba(252,160,0,0.2); border: 2px solid rgba(252,160,0,0.5);">üü° Default</button>
              <button class="preset-btn" onclick="applyDonationTheme('dark')" style="background: rgba(255,107,0,0.2); border: 2px solid rgba(255,107,0,0.5);">üåô Dark</button>
              <button class="preset-btn" onclick="applyDonationTheme('neon')" style="background: rgba(255,0,255,0.2); border: 2px solid rgba(255,0,255,0.5);">‚ö° Neon</button>
              <button class="preset-btn" onclick="applyDonationTheme('pastel')" style="background: rgba(255,105,180,0.2); border: 2px solid rgba(255,105,180,0.5);">üå∏ Pastel</button>
            </div>

            <div style="margin-top: 15px;">
              <label>Couleur du texte</label>
              <input type="color" id="donationTextColor" value="#f2f5f8" onchange="updatePreview()">
            </div>

            <div style="margin-top: 15px;">
              <label>Couleur du texte ternes (muted)</label>
              <input type="color" id="donationMutedColor" value="#a7b1bd" onchange="updatePreview()">
            </div>

            <div style="margin-top: 15px;">
              <label>Couleur d'accent</label>
              <input type="color" id="donationAccentColor" value="#FCA000" onchange="updatePreview()">
            </div>

            <div style="margin-top: 15px;">
              <label>Couleur de fond de la barre</label>
              <input type="color" id="donationBarBg" value="#0b0f14" onchange="updatePreview()">
            </div>

            <div style="margin-top: 15px;">
              <label>Opacit√© du fond</label>
              <div style="display: flex; gap: 10px; align-items: center;">
                <input type="range" id="donationBarOpacity" min="0" max="1" step="0.1" value="0.75" onchange="updatePreview()">
                <span class="intensity-value" id="donationBarOpacityValue">0.75</span>
              </div>
            </div>

            <div style="margin-top: 15px;">
              <label>Flou (blur) de la barre</label>
              <div style="display: flex; gap: 10px; align-items: center;">
                <input type="range" id="donationBarBlur" min="0" max="20" step="1" value="8" onchange="updatePreview()">
                <span class="intensity-value" id="donationBarBlurValue">8px</span>
              </div>
            </div>

            <div style="margin-top: 15px;">
              <label>Rayon des coins (border-radius)</label>
              <input type="text" id="donationBarRadius" placeholder="0px" style="width: 100%; padding: 8px; border-radius: 4px; border: 1px solid rgba(255,255,255,0.2); background: rgba(0,0,0,0.3); color: #f2f5f8;" value="0px" onchange="updatePreview()">
            </div>

            <div style="margin-top: 15px;">
              <label>Couleur du fond cagnotte</label>
              <input type="color" id="donationGoalBg" value="#fca000" onchange="updatePreview()">
            </div>

            <div style="margin-top: 15px;">
              <label>Taille de la police</label>
              <div style="display: flex; gap: 10px; align-items: center;">
                <input type="range" id="donationFontScale" min="0.5" max="2" step="0.1" value="1" onchange="updatePreview()">
                <span class="intensity-value" id="donationFontScaleValue">1</span>
              </div>
            </div>

            <div style="margin-top: 15px;">
              <label>Texte personnalis√©</label>
              <input type="text" id="donationCustomText" placeholder="Ex: Donation Bar" style="width: 100%; padding: 8px; border-radius: 4px; border: 1px solid rgba(255,255,255,0.2); background: rgba(0,0,0,0.3); color: #f2f5f8;" onchange="updatePreview()">
            </div>
          </div>
        </div>
        <div class="link-section">
          <h3>üìã Lien g√©n√©r√©</h3>
          <div class="generated-link" id="generatedLink">S√©lectionne une overlay...</div>
          <div class="button-group">
            <button onclick="copyLink()">üìã Copier</button>
            <button onclick="openInNewTab()" style="background: rgba(100, 150, 200, 0.5);">üîó Ouvrir</button>
          </div>
          <div class="copy-feedback" id="copyFeedback">‚úì Copi√©!</div>
        </div>
      </div>

      <!-- Preview Panel -->
      <div class="panel">
        <h2>üëÅÔ∏è Aper√ßu</h2>
        <div id="previewContainer"></div>
        <div class="info-box" style="margin-top: 30px;">
          <strong>üé¨ Comment l'utiliser:</strong><br>
          1. S√©lectionne le type<br>
          2. Choisis une overlay<br>
          3. Configure les couleurs<br>
          4. Copie le lien<br>
          5. Colle dans OBS
        </div>
      </div>
    </div>
  </div>

  <script>
    const GITHUB_URL = 'https://createursdecompagnie.github.io/cdc2025-live-stats';
    
    const overlaysByCategory = {
      Cagnotte: {
        'cdc_goal_widget_simple.html': {
          label: 'Simple',
          desc: 'Montant seul',
          supportColors: true,
          supportCents: true,
          showPreview: true
        },
        'cdc_goal_widget.html': {
          label: 'Complet',
          desc: 'Avec CDC2025',
          supportColors: true,
          supportCents: true,
          showPreview: true
        }
      },
      Infos: {
        'info_widget.html': {
          label: 'Info Standard',
          desc: 'Infos √©v√©nement',
          supportColors: true,
          supportCents: false,
          showPreview: true,
          customOptions: {
            themes: true,
            textColor: true,
            accentColor: true,
            bgOpacity: true
          }
        },
        'info_widget_vertical.html': {
          label: 'Info Vertical',
          desc: 'Infos verticales',
          supportColors: false,
          supportCents: false,
          showPreview: true,
          customOptions: {
            themes: true,
            textColor: true,
            accentColor: true,
            bgOpacity: true
          }
        },
        'info_carousel_square.html': {
          label: 'Carousel Carr√©',
          desc: 'Carousel infos',
          supportColors: false,
          supportCents: false,
          showPreview: true,
          customOptions: {
            themes: true,
            textColor: true,
            accentColor: true,
            bgOpacity: true
          }
        },
        'widget-creators.html': {
          label: 'Cr√©ateurs',
          desc: 'Widget cr√©ateurs en direct',
          supportColors: true,
          supportCents: false,
          showPreview: true,
          customOptions: {
            widgetCreators: true
          }
        }
      },
      Barres: {
        'donation_bar.html': {
          label: 'Barre Donation',
          desc: 'Progression',
          supportColors: false,
          supportCents: false,
          showPreview: true,
          customOptions: { donationBar: true }
        },
        'Widget_Bar.html': {
          label: 'Bar Horizontal',
          desc: 'Barre standard',
          supportColors: false,
          supportCents: false,
          showPreview: true,
          customOptions: { widgetBar: true }
        },
        'Widget_Bar_Vertical.html': {
          label: 'Bar Vertical',
          desc: 'Barre verticale',
          supportColors: false,
          supportCents: false,
          showPreview: true,
          customOptions: { widgetBar: true }
        }
      }
    };

    const presets = {
      default: { 
        textColor: '#ffffff', 
        accentColor: '#FCA000', 
        shadowIntensity: 0.4,
        borderColor: 'rgba(252,160,0,0.5)',
        barText: '#f2f5f8',
        barNumbers: '#ffffff',
        barAccent: '#FCA000',
        barBg: '#0b0f14',
        barOpacity: 0.75,
        logoGradStart: '#FFE259',
        logoGradEnd: '#FFA751',
        creatorsBorderLive: '#ff6961',
        creatorsBorderOffline: '#b0b0b0',
        creatorsText: '#f2f5f8',
        creatorsAccent: '#FCA000'
      },
      dark: { 
        textColor: '#e0e0e0', 
        accentColor: '#ff6b00', 
        shadowIntensity: 0.6,
        borderColor: 'rgba(255,107,0,0.5)',
        barText: '#d0d0d0',
        barNumbers: '#ffffff',
        barAccent: '#ff6b00',
        barBg: '#1a1a1a',
        barOpacity: 0.85,
        logoGradStart: '#FF8C00',
        logoGradEnd: '#FF6347',
        creatorsBorderLive: '#ff4444',
        creatorsBorderOffline: '#888888',
        creatorsText: '#d0d0d0',
        creatorsAccent: '#ff6b00'
      },
      neon: { 
        textColor: '#00ffff', 
        accentColor: '#ff00ff', 
        shadowIntensity: 0.8,
        borderColor: 'rgba(255,0,255,0.6)',
        barText: '#00ffff',
        barNumbers: '#ffff00',
        barAccent: '#ff00ff',
        barBg: '#0a0a1a',
        barOpacity: 0.9,
        logoGradStart: '#00FFFF',
        logoGradEnd: '#FF00FF',
        creatorsBorderLive: '#00ffff',
        creatorsBorderOffline: '#ff00ff',
        creatorsText: '#00ffff',
        creatorsAccent: '#ffff00'
      },
      pastel: { 
        textColor: '#fff9e6', 
        accentColor: '#ff69b4', 
        shadowIntensity: 0.3,
        borderColor: 'rgba(255,105,180,0.4)',
        barText: '#ffe6f0',
        barNumbers: '#fff9e6',
        barAccent: '#ff69b4',
        barBg: '#f5f0fa',
        barOpacity: 0.7,
        logoGradStart: '#FFB6D9',
        logoGradEnd: '#FFD1DC',
        creatorsBorderLive: '#ffb3d9',
        creatorsBorderOffline: '#e6d7f0',
        creatorsText: '#fff9e6',
        creatorsAccent: '#ff69b4'
      }
    };

    const donationPresets = {
      default: {
        text: '#f2f5f8',
        muted: '#a7b1bd',
        accent: '#FCA000',
        barBg: '#0b0f14',
        barOpacity: 0.75,
        barBlur: '8px',
        barRadius: '0px',
        goalBg: 'rgba(252,160,0,0.1)',
        goalBorder: 'rgba(252,160,0,0.2)',
        fs: 1
      },
      dark: {
        text: '#d0d0d0',
        muted: '#888888',
        accent: '#ff6b00',
        barBg: '#1a1a1a',
        barOpacity: 0.85,
        barBlur: '12px',
        barRadius: '0px',
        goalBg: 'rgba(255,107,0,0.1)',
        goalBorder: 'rgba(255,107,0,0.2)',
        fs: 1
      },
      neon: {
        text: '#00ffff',
        muted: '#ff00ff',
        accent: '#ffff00',
        barBg: '#0a0a1a',
        barOpacity: 0.9,
        barBlur: '15px',
        barRadius: '8px',
        goalBg: 'rgba(255,0,255,0.15)',
        goalBorder: 'rgba(0,255,255,0.3)',
        fs: 1
      },
      pastel: {
        text: '#fff9e6',
        muted: '#e6d7f0',
        accent: '#ff69b4',
        barBg: '#f5f0fa',
        barOpacity: 0.7,
        barBlur: '10px',
        barRadius: '12px',
        goalBg: 'rgba(255,105,180,0.1)',
        goalBorder: 'rgba(255,105,180,0.2)',
        fs: 1
      }
    };

    let currentCategory = null;
    let currentOverlay = null;

    function initCategorySelector() {
      const selector = document.getElementById('categorySelector');
      Object.keys(overlaysByCategory).forEach(cat => {
        const btn = document.createElement('button');
        btn.className = 'category-btn';
        btn.textContent = cat;
        btn.onclick = () => selectCategory(cat);
        selector.appendChild(btn);
      });
      selectCategory(Object.keys(overlaysByCategory)[0]);
    }

    function selectCategory(cat) {
      currentCategory = cat;
      document.querySelectorAll('.category-btn').forEach(btn => {
        btn.classList.toggle('active', btn.textContent === cat);
      });
      populateOverlays();
    }

    function populateOverlays() {
      const grid = document.getElementById('overlayGrid');
      grid.innerHTML = '';
      const overlays = overlaysByCategory[currentCategory];
      Object.entries(overlays).forEach(([file, info]) => {
        const btn = document.createElement('button');
        btn.className = 'overlay-btn';
        btn.textContent = info.label;
        btn.title = info.desc;
        btn.onclick = (e) => selectOverlay(file, info, btn);
        grid.appendChild(btn);
      });
      // Select first overlay
      const firstBtn = grid.querySelector('.overlay-btn');
      const firstFile = Object.keys(overlays)[0];
      const firstInfo = Object.values(overlays)[0];
      selectOverlay(firstFile, firstInfo, firstBtn);
    }

    function selectOverlay(file, info, btnElement) {
      currentOverlay = { file, ...info };
      document.querySelectorAll('.overlay-btn').forEach(btn => btn.classList.remove('active'));
      if (btnElement) {
        btnElement.classList.add('active');
      }
      updateCustomOptions();
      updatePreview();
    }

    function updateCustomOptions() {
      if (!currentOverlay) return;

      const customOpts = document.getElementById('customOptions');
      const presetBtns = document.getElementById('presetButtons');
      const centsOpt = document.getElementById('centsOption');
      const themeOpts = document.getElementById('themeOptions');
      const colorOpts = document.getElementById('colorOptions');
      const shadowOpts = document.getElementById('shadowOptions');
      const opacityOpts = document.getElementById('opacityOptions');
      const visibilityOpts = document.getElementById('visibilityOptions');
      const creatorsOpts = document.getElementById('creatorsOptions');
      const barOpts = document.getElementById('barOptions');

      // Cagnotte: Show colors + shadow + cents option
      if (currentOverlay.file.includes('cdc_goal_widget')) {
        customOpts.style.display = 'block';
        presetBtns.style.display = 'grid';
        presetBtns.innerHTML = '';
        ['default', 'dark', 'neon', 'pastel'].forEach(name => {
          const btn = document.createElement('button');
          btn.className = 'preset-btn';
          btn.textContent = name.charAt(0).toUpperCase() + name.slice(1);
          btn.onclick = () => applyPreset(name);
          presetBtns.appendChild(btn);
        });
        if (colorOpts) colorOpts.style.display = 'block';
        if (shadowOpts) shadowOpts.style.display = 'block';
        if (opacityOpts) opacityOpts.style.display = 'none';
        if (themeOpts) themeOpts.style.display = 'none';
        if (visibilityOpts) visibilityOpts.style.display = 'none';
        if (centsOpt) centsOpt.style.display = currentOverlay.supportCents ? 'flex' : 'none';
        if (creatorsOpts) creatorsOpts.style.display = 'none';
        if (barOpts) barOpts.style.display = 'none';
      }
      // Widget Creators: Show specific options
      else if (currentOverlay.file.includes('widget-creators')) {
        customOpts.style.display = 'block';
        presetBtns.style.display = 'none';
        if (themeOpts) themeOpts.style.display = 'none';
        if (colorOpts) colorOpts.style.display = 'none';
        if (shadowOpts) shadowOpts.style.display = 'none';
        if (opacityOpts) opacityOpts.style.display = 'none';
        if (visibilityOpts) visibilityOpts.style.display = 'none';
        if (centsOpt) centsOpt.style.display = 'none';
        if (creatorsOpts) creatorsOpts.style.display = 'block';
        if (barOpts) barOpts.style.display = 'none';
      }
      // Widget Bar: Show bar-specific options
      else if (currentOverlay.file.includes('Widget_Bar')) {
        customOpts.style.display = 'block';
        presetBtns.style.display = 'none';
        if (themeOpts) themeOpts.style.display = 'none';
        if (colorOpts) colorOpts.style.display = 'none';
        if (shadowOpts) shadowOpts.style.display = 'none';
        if (opacityOpts) opacityOpts.style.display = 'none';
        if (visibilityOpts) visibilityOpts.style.display = 'none';
        if (centsOpt) centsOpt.style.display = 'none';
        if (creatorsOpts) creatorsOpts.style.display = 'none';
        if (barOpts) barOpts.style.display = 'block';
        const donationOpts = document.getElementById('donationOptions');
        if (donationOpts) donationOpts.style.display = 'none';
      }
      // Donation Bar: Show donation-specific options
      else if (currentOverlay.file.includes('donation_bar')) {
        customOpts.style.display = 'block';
        presetBtns.style.display = 'none';
        if (themeOpts) themeOpts.style.display = 'none';
        if (colorOpts) colorOpts.style.display = 'none';
        if (shadowOpts) shadowOpts.style.display = 'none';
        if (opacityOpts) opacityOpts.style.display = 'none';
        if (visibilityOpts) visibilityOpts.style.display = 'none';
        if (centsOpt) centsOpt.style.display = 'none';
        if (creatorsOpts) creatorsOpts.style.display = 'none';
        if (barOpts) barOpts.style.display = 'none';
        const donationOpts = document.getElementById('donationOptions');
        if (donationOpts) donationOpts.style.display = 'block';
      }
      // Info widgets (standard, vertical) + Carousel: Show themes + colors + opacity + visibility
      else if (currentOverlay.file.includes('info_widget') || currentOverlay.file.includes('info_carousel')) {
        customOpts.style.display = 'block';
        presetBtns.style.display = 'none';
        if (themeOpts) themeOpts.style.display = 'block';
        if (colorOpts) colorOpts.style.display = 'block';
        if (shadowOpts) shadowOpts.style.display = 'none';
        if (opacityOpts) opacityOpts.style.display = 'block';
        // Only show visibility toggles for main info_widget (not carousel or vertical)
        if (visibilityOpts) visibilityOpts.style.display = currentOverlay.file.includes('info_widget.html') ? 'block' : 'none';
        if (centsOpt) centsOpt.style.display = 'none';
        if (creatorsOpts) creatorsOpts.style.display = 'none';
        if (barOpts) barOpts.style.display = 'none';
        
        // Initialize theme buttons
        const themeSelector = document.getElementById('themeSelector');
        if (themeSelector) {
          themeSelector.querySelectorAll('.theme-btn').forEach(btn => {
            btn.classList.remove('active');
            if (btn.dataset.theme === 'light') btn.classList.add('active');
          });
        }
      }
      // Other overlays: Hide options
      else {
        customOpts.style.display = 'none';
      }
    }

    function applyPreset(name) {
      const p = presets[name];
      document.getElementById('textColor').value = p.textColor;
      document.getElementById('accentColor').value = p.accentColor;
      document.getElementById('shadowIntensity').value = p.shadowIntensity;
      updatePreview();
    }

    function applyBarTheme(name) {
      const p = presets[name];
      document.getElementById('barTextColor').value = p.barText;
      document.getElementById('barNumbersColor').value = p.barNumbers;
      document.getElementById('barAccentColor').value = p.barAccent;
      document.getElementById('barCagnotteColor').value = p.barAccent;
      document.getElementById('barBgColor').value = p.barBg;
      document.getElementById('barOpacitySlider').value = p.barOpacity;
      document.getElementById('barOpacityValue').textContent = p.barOpacity;
      document.getElementById('logoGradStart').value = p.logoGradStart;
      document.getElementById('logoGradEnd').value = p.logoGradEnd;
      updatePreview();
    }

    function applyCreatorsTheme(name) {
      const p = presets[name];
      document.getElementById('borderLive').value = p.creatorsBorderLive;
      document.getElementById('borderOffline').value = p.creatorsBorderOffline;
      document.getElementById('creatorsTextColor').value = p.creatorsText;
      document.getElementById('creatorsAccentColor').value = p.creatorsAccent;
      updatePreview();
    }

    function applyDonationTheme(name) {
      const p = donationPresets[name];
      if (!p) return;
      document.getElementById('donationTextColor').value = p.text;
      document.getElementById('donationMutedColor').value = p.muted;
      document.getElementById('donationAccentColor').value = p.accent;
      document.getElementById('donationBarBg').value = p.barBg;
      document.getElementById('donationBarOpacity').value = p.barOpacity;
      document.getElementById('donationBarOpacityValue').textContent = p.barOpacity;
      document.getElementById('donationBarBlur').value = p.barBlur.replace('px', '');
      document.getElementById('donationBarBlurValue').textContent = p.barBlur;
      document.getElementById('donationBarRadius').value = p.barRadius;
      document.getElementById('donationFontScale').value = p.fs;
      document.getElementById('donationFontScaleValue').textContent = p.fs;
      updatePreview();
    }

    function applyTheme(theme) {
      const themeSelector = document.getElementById('themeSelector');
      if (!themeSelector) return;
      
      // Update button states
      themeSelector.querySelectorAll('.theme-btn').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.theme === theme);
      });
      
      // Update preview
      updatePreview();
    }

    function updatePreview() {
      // Get values safely, with fallbacks
      const textColorEl = document.getElementById('textColor');
      const accentColorEl = document.getElementById('accentColor');
      const shadowIntensityEl = document.getElementById('shadowIntensity');
      const bgOpacityEl = document.getElementById('bgOpacity');
      const showCentsEl = document.getElementById('showCents');

      const textColor = textColorEl ? textColorEl.value : '#ffffff';
      const accentColor = accentColorEl ? accentColorEl.value : '#FCA000';
      const shadowIntensity = shadowIntensityEl ? shadowIntensityEl.value : '0.4';
      const bgOpacity = bgOpacityEl ? bgOpacityEl.value : '0.5';
      const showCents = showCentsEl ? showCentsEl.checked : false;

      // Get theme if available
      const themeBtn = document.querySelector('.theme-btn.active');
      const theme = themeBtn ? themeBtn.dataset.theme : 'light';

      if (currentOverlay.supportColors) {
        if (currentOverlay.file.includes('cdc_goal_widget')) {
          const shadowVal = document.getElementById('shadowValue');
          if (shadowVal) shadowVal.textContent = shadowIntensity;
        }
        if (currentOverlay.file.includes('info_widget')) {
          const opacityVal = document.getElementById('opacityValue');
          if (opacityVal) opacityVal.textContent = bgOpacity;
        }
      }

      const params = new URLSearchParams();
      
      // Cagnotte parameters
      if (currentOverlay.file.includes('cdc_goal_widget')) {
        params.append('textColor', textColor);
        params.append('accentColor', accentColor);
        params.append('shadowIntensity', shadowIntensity);
        if (currentOverlay.supportCents && showCents) {
          params.append('showCents', 'true');
        }
      }
      // Widget Creators parameters
      else if (currentOverlay.file.includes('widget-creators')) {
        const borderLive = document.getElementById('borderLive')?.value || '#ff6961';
        const borderOffline = document.getElementById('borderOffline')?.value || '#b0b0b0';
        const creatorsTextColor = document.getElementById('creatorsTextColor')?.value || '#f2f5f8';
        const creatorsAccentColor = document.getElementById('creatorsAccentColor')?.value || '#FCA000';
        const labelLiveVal = document.getElementById('labelLive')?.value || '';
        const labelOfflineVal = document.getElementById('labelOffline')?.value || '';
        const bgColorVal = document.getElementById('bgColor')?.value || '#0b0f14';
        const bgOpacityVal = document.getElementById('bgOpacityCreators')?.value || '0.85';
        const tagBgColorVal = document.getElementById('tagBgColor')?.value || '#0b0f14';
        const tagBgOpacityVal = document.getElementById('tagBgOpacity')?.value || '1';
        
        // Mettre √† jour les valeurs affich√©es
        const bgOpacityDisplay = document.getElementById('bgOpacityCreatorsValue');
        if (bgOpacityDisplay) bgOpacityDisplay.textContent = bgOpacityVal;
        const tagBgOpacityDisplay = document.getElementById('tagBgOpacityValue');
        if (tagBgOpacityDisplay) tagBgOpacityDisplay.textContent = tagBgOpacityVal;
        
        params.append('borderLive', borderLive);
        params.append('borderOffline', borderOffline);
        params.append('textColor', creatorsTextColor);
        params.append('accent', creatorsAccentColor);
        params.append('bgColor', bgColorVal);
        params.append('bgOpacity', bgOpacityVal);
        params.append('tagBgColor', tagBgColorVal);
        params.append('tagBgOpacity', tagBgOpacityVal);
        if (labelLiveVal) params.append('labelLive', labelLiveVal);
        if (labelOfflineVal) params.append('labelOffline', labelOfflineVal);
      }
      // Widget Bar parameters
      else if (currentOverlay.file.includes('Widget_Bar')) {
        const barTextColor = document.getElementById('barTextColor')?.value || '#f2f5f8';
        const barNumbersColor = document.getElementById('barNumbersColor')?.value || '#ffffff';
        const barAccentColor = document.getElementById('barAccentColor')?.value || '#FCA000';
        const barBgColor = document.getElementById('barBgColor')?.value || '#0b0f14';
        const barOpacity = document.getElementById('barOpacitySlider')?.value || '0.75';
        const logoGradStart = document.getElementById('logoGradStart')?.value || '#FFE259';
        const logoGradEnd = document.getElementById('logoGradEnd')?.value || '#FFA751';
        const showCagnotte = document.getElementById('barShowCagnotte')?.checked !== false ? 'true' : 'false';
        const showStats = document.getElementById('barShowStats')?.checked !== false ? 'true' : 'false';
        const showHashtag = document.getElementById('barShowHashtag')?.checked !== false ? 'true' : 'false';
        const barHashtagVal = document.getElementById('barHashtag')?.value || '#ProtectionAnimale';
        const barCagnotteColorVal = document.getElementById('barCagnotteColor')?.value || '#FCA000';
        
        // Update display values
        const barOpacityDisplay = document.getElementById('barOpacityValue');
        if (barOpacityDisplay) barOpacityDisplay.textContent = barOpacity;
        
        params.append('text', barTextColor);
        params.append('numbers', barNumbersColor);
        params.append('accent', barAccentColor);
        params.append('barBg', barBgColor);
        params.append('barOpacity', barOpacity);
        params.append('logoGradientStart', logoGradStart);
        params.append('logoGradientEnd', logoGradEnd);
        if (barHashtagVal) params.append('hashtag', barHashtagVal);
        if (barCagnotteColorVal !== barAccentColor) params.append('cagnotteColor', barCagnotteColorVal);
        if (showCagnotte !== 'true') params.append('showCagnotte', 'false');
        if (showStats !== 'true') params.append('showStats', 'false');
        if (showHashtag !== 'true') params.append('showHashtag', 'false');
      }
      // Donation Bar parameters
      else if (currentOverlay.file.includes('donation_bar')) {
        const donationText = document.getElementById('donationTextColor')?.value || '#f2f5f8';
        const donationMuted = document.getElementById('donationMutedColor')?.value || '#a7b1bd';
        const donationAccent = document.getElementById('donationAccentColor')?.value || '#FCA000';
        const donationBarBg = document.getElementById('donationBarBg')?.value || '#0b0f14';
        const donationOpacity = document.getElementById('donationBarOpacity')?.value || '0.75';
        const donationBlur = document.getElementById('donationBarBlur')?.value || '8';
        const donationRadius = document.getElementById('donationBarRadius')?.value || '0px';
        const donationGoalBg = document.getElementById('donationGoalBg')?.value || '#fca000';
        const donationFontScale = document.getElementById('donationFontScale')?.value || '1';
        const donationCustomText = document.getElementById('donationCustomText')?.value || '';
        
        // Update display values
        const opacityDisplay = document.getElementById('donationBarOpacityValue');
        if (opacityDisplay) opacityDisplay.textContent = donationOpacity;
        const blurDisplay = document.getElementById('donationBarBlurValue');
        if (blurDisplay) blurDisplay.textContent = donationBlur + 'px';
        const fsDisplay = document.getElementById('donationFontScaleValue');
        if (fsDisplay) fsDisplay.textContent = donationFontScale;
        
        params.append('text', donationText);
        params.append('muted', donationMuted);
        params.append('accent', donationAccent);
        params.append('barBg', donationBarBg);
        params.append('barBorder', 'rgba(255,255,255,0.06)');
        params.append('barBlur', donationBlur + 'px');
        params.append('barRadius', donationRadius);
        params.append('goalBg', donationGoalBg);
        params.append('fs', donationFontScale);
        if (donationCustomText) params.append('customText', donationCustomText);
      }
      else if (currentOverlay.file.includes('info_widget')) {
        params.append('theme', theme);
        params.append('textColor', textColor);
        params.append('accentColor', accentColor);
        params.append('bgOpacity', bgOpacity);
        
        // Add hide parameter based on visibility checkboxes
        const hiddenSections = [];
        if (!document.getElementById('showPersonal')?.checked) hiddenSections.push('personal');
        if (!document.getElementById('showBranding')?.checked) hiddenSections.push('branding');
        if (!document.getElementById('showStats')?.checked) hiddenSections.push('stats');
        if (!document.getElementById('showInfo')?.checked) hiddenSections.push('info');
        
        if (hiddenSections.length > 0) {
          params.append('hide', hiddenSections.join(','));
        }
      }

      const fullUrl = `${GITHUB_URL}/${currentOverlay.file}${params.toString() ? '?' + params.toString() : ''}`;
      const linkEl = document.getElementById('generatedLink');
      if (linkEl) linkEl.textContent = fullUrl;

      // Render preview
      renderPreview(textColor, accentColor, shadowIntensity, bgOpacity, showCents, theme);
    }

    function renderPreview(textColor, accentColor, shadowIntensity, bgOpacity, showCents, theme) {
      const container = document.getElementById('previewContainer');
      container.innerHTML = '';

      if (currentOverlay.showPreview) {
        const params = new URLSearchParams();
        
        if (currentOverlay.file.includes('cdc_goal_widget')) {
          params.append('textColor', textColor);
          params.append('accentColor', accentColor);
          params.append('shadowIntensity', shadowIntensity);
          if (currentOverlay.supportCents && showCents) {
            params.append('showCents', 'true');
          }
        } else if (currentOverlay.file.includes('widget-creators')) {
          const borderLive = document.getElementById('borderLive')?.value || '#ff6961';
          const borderOffline = document.getElementById('borderOffline')?.value || '#b0b0b0';
          const creatorsTextColor = document.getElementById('creatorsTextColor')?.value || '#f2f5f8';
          const creatorsAccentColor = document.getElementById('creatorsAccentColor')?.value || '#FCA000';
          const labelLiveVal = document.getElementById('labelLive')?.value || '';
          const labelOfflineVal = document.getElementById('labelOffline')?.value || '';
          const bgColorVal = document.getElementById('bgColor')?.value || '#0b0f14';
          const bgOpacityVal = document.getElementById('bgOpacityCreators')?.value || '0.85';
          const tagBgColorVal = document.getElementById('tagBgColor')?.value || '#0b0f14';
          const tagBgOpacityVal = document.getElementById('tagBgOpacity')?.value || '1';
          
          params.append('borderLive', borderLive);
          params.append('borderOffline', borderOffline);
          params.append('textColor', creatorsTextColor);
          params.append('accent', creatorsAccentColor);
          params.append('bgColor', bgColorVal);
          params.append('bgOpacity', bgOpacityVal);
          params.append('tagBgColor', tagBgColorVal);
          params.append('tagBgOpacity', tagBgOpacityVal);
          if (labelLiveVal) params.append('labelLive', labelLiveVal);
          if (labelOfflineVal) params.append('labelOffline', labelOfflineVal);
        } else if (currentOverlay.file.includes('Widget_Bar')) {
          const barTextColor = document.getElementById('barTextColor')?.value || '#f2f5f8';
          const barNumbersColor = document.getElementById('barNumbersColor')?.value || '#ffffff';
          const barAccentColor = document.getElementById('barAccentColor')?.value || '#FCA000';
          const barBgColor = document.getElementById('barBgColor')?.value || '#0b0f14';
          const barOpacity = document.getElementById('barOpacitySlider')?.value || '0.75';
          const logoGradStart = document.getElementById('logoGradStart')?.value || '#FFE259';
          const logoGradEnd = document.getElementById('logoGradEnd')?.value || '#FFA751';
          const showCagnotte = document.getElementById('barShowCagnotte')?.checked !== false ? 'true' : 'false';
          const showStats = document.getElementById('barShowStats')?.checked !== false ? 'true' : 'false';
          const showHashtag = document.getElementById('barShowHashtag')?.checked !== false ? 'true' : 'false';
          const barHashtagVal = document.getElementById('barHashtag')?.value || '#ProtectionAnimale';
          const barCagnotteColorVal = document.getElementById('barCagnotteColor')?.value || '#FCA000';
          
          params.append('text', barTextColor);
          params.append('numbers', barNumbersColor);
          params.append('accent', barAccentColor);
          params.append('barBg', barBgColor);
          params.append('barOpacity', barOpacity);
          params.append('logoGradientStart', logoGradStart);
          params.append('logoGradientEnd', logoGradEnd);
          if (barHashtagVal) params.append('hashtag', barHashtagVal);
          if (barCagnotteColorVal !== barAccentColor) params.append('cagnotteColor', barCagnotteColorVal);
          if (showCagnotte !== 'true') params.append('showCagnotte', 'false');
          if (showStats !== 'true') params.append('showStats', 'false');
          if (showHashtag !== 'true') params.append('showHashtag', 'false');
        } else if (currentOverlay.file.includes('donation_bar')) {
          const donationText = document.getElementById('donationTextColor')?.value || '#f2f5f8';
          const donationMuted = document.getElementById('donationMutedColor')?.value || '#a7b1bd';
          const donationAccent = document.getElementById('donationAccentColor')?.value || '#FCA000';
          const donationBarBg = document.getElementById('donationBarBg')?.value || '#0b0f14';
          const donationOpacity = document.getElementById('donationBarOpacity')?.value || '0.75';
          const donationBlur = document.getElementById('donationBarBlur')?.value || '8';
          const donationRadius = document.getElementById('donationBarRadius')?.value || '0px';
          const donationGoalBg = document.getElementById('donationGoalBg')?.value || '#fca000';
          const donationFontScale = document.getElementById('donationFontScale')?.value || '1';
          
          params.append('text', donationText);
          params.append('muted', donationMuted);
          params.append('accent', donationAccent);
          params.append('barBg', donationBarBg);
          params.append('barBorder', 'rgba(255,255,255,0.06)');
          params.append('barBlur', donationBlur + 'px');
          params.append('barRadius', donationRadius);
          params.append('goalBg', donationGoalBg);
          params.append('fs', donationFontScale);
        } else if (currentOverlay.file.includes('info_widget')) {
          params.append('theme', theme || 'light');
          params.append('textColor', textColor);
          params.append('accentColor', accentColor);
          params.append('bgOpacity', bgOpacity);
          
          // Add hide parameter based on visibility checkboxes (only for main info_widget)
          if (currentOverlay.file.includes('info_widget.html')) {
            const hiddenSections = [];
            if (!document.getElementById('showPersonal')?.checked) hiddenSections.push('personal');
            if (!document.getElementById('showBranding')?.checked) hiddenSections.push('branding');
            if (!document.getElementById('showStats')?.checked) hiddenSections.push('stats');
            if (!document.getElementById('showInfo')?.checked) hiddenSections.push('info');
            
            if (hiddenSections.length > 0) {
              params.append('hide', hiddenSections.join(','));
            }
          }
        } else if (currentOverlay.file.includes('info_carousel')) {
          params.append('theme', theme || 'light');
          params.append('textColor', textColor);
          params.append('accentColor', accentColor);
          params.append('bgOpacity', bgOpacity);
        }

        const url = `${GITHUB_URL}/${currentOverlay.file}${params.toString() ? '?' + params.toString() : ''}`;
        
        // Determine iframe type for styling
        let iframeType = 'default';
        if (currentOverlay.file.includes('info_widget') || currentOverlay.file.includes('info_carousel')) {
          iframeType = 'info';
        }

        const item = document.createElement('div');
        item.className = 'preview-item';
        item.innerHTML = `
          <h4>${currentOverlay.label}</h4>
          <p>${currentOverlay.desc}</p>
          <iframe src="${url}" data-type="${iframeType}"></iframe>
        `;
        container.appendChild(item);
      } else {
        container.innerHTML = '<div class="info-box">Cet overlay n\'a pas d\'aper√ßu disponible en iframe. V√©rifie le lien g√©n√©r√© directement!</div>';
      }
    }

    function copyLink() {
      const link = document.getElementById('generatedLink').textContent;
      navigator.clipboard.writeText(link).then(() => {
        const feedback = document.getElementById('copyFeedback');
        feedback.style.display = 'block';
        setTimeout(() => {
          feedback.style.display = 'none';
        }, 2000);
      });
    }

    function openInNewTab() {
      const link = document.getElementById('generatedLink').textContent;
      window.open(link, '_blank');
    }

    // Add listeners for donation sliders to update display values
    document.addEventListener('DOMContentLoaded', () => {
      const donationOpacitySlider = document.getElementById('donationBarOpacity');
      if (donationOpacitySlider) {
        donationOpacitySlider.addEventListener('input', (e) => {
          document.getElementById('donationBarOpacityValue').textContent = e.target.value;
        });
      }
      
      const donationBlurSlider = document.getElementById('donationBarBlur');
      if (donationBlurSlider) {
        donationBlurSlider.addEventListener('input', (e) => {
          document.getElementById('donationBarBlurValue').textContent = e.target.value + 'px';
        });
      }
      
      const donationFontSlider = document.getElementById('donationFontScale');
      if (donationFontSlider) {
        donationFontSlider.addEventListener('input', (e) => {
          document.getElementById('donationFontScaleValue').textContent = e.target.value;
        });
      }
    });

    window.addEventListener('load', initCategorySelector);
  </script>

</body>
</html>
